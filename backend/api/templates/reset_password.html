<!DOCTYPE html>
<html>

<head>
    <title>Redefinir Senha - VigiAA</title>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .card { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); width: 100%; max-width: 400px; text-align: center; }
        input { width: 90%; padding: 12px; margin: 8px 0; border: 1px solid #ccc; border-radius: 5px; font-size: 14px; }
        button { background: #007bff; color: white; border: none; padding: 12px 20px; border-radius: 5px; cursor: pointer; font-size: 16px; width: 100%; margin-top: 10px;}
        button:hover { background: #0056b3; }
        button:disabled { background: #cccccc; cursor: not-allowed; }
        .success { color: green; font-weight: bold; background: #e8f5e9; padding: 10px; border-radius: 5px; }
        .error { color: #d32f2f; font-size: 13px; margin-top: -5px; margin-bottom: 10px; display: none; }
        .backend-error { color: red; margin-bottom: 10px; background: #ffebee; padding: 10px; border-radius: 5px; }
    </style>
</head>

<body>
    <div class="card">
        <h2>üîí Nova Senha</h2>
        
        {% if success %}
            <div class="success">
                <p>‚úÖ Senha alterada com sucesso!</p>
            </div>
            <p style="color: #666;">Voc√™ j√° pode fechar esta janela e entrar no aplicativo.</p>
        {% else %}
            <p>Crie uma nova senha para sua conta.</p>
            
            {% if error %}
                <p class="backend-error">{{ error }}</p>
            {% endif %}

            <form method="POST" onsubmit="return validateForm()">
                {% csrf_token %}
                
                <input type="password" id="pass1" name="password" placeholder="Nova Senha" required minlength="6" onkeyup="checkPass()">
                
                <input type="password" id="pass2" name="confirm_password" placeholder="Confirme a Nova Senha" required minlength="6" onkeyup="checkPass()">
                
                <p id="match-error" class="error">‚ùå As senhas n√£o conferem!</p>

                <button type="submit" id="btn-submit">Salvar Nova Senha</button>
            </form>
        {% endif %}
    </div>

    <script>
        function checkPass() {
            let p1 = document.getElementById('pass1').value;
            let p2 = document.getElementById('pass2').value;
            let errorMsg = document.getElementById('match-error');
            let btn = document.getElementById('btn-submit');

            // S√≥ mostra erro se o usu√°rio j√° come√ßou a digitar a confirma√ß√£o
            if (p2.length > 0 && p1 !== p2) {
                errorMsg.style.display = 'block';
                btn.disabled = true;
                btn.style.opacity = "0.7";
            } else {
                errorMsg.style.display = 'none';
                btn.disabled = false;
                btn.style.opacity = "1";
            }
        }

        function validateForm() {
            let p1 = document.getElementById('pass1').value;
            let p2 = document.getElementById('pass2').value;
            if (p1 !== p2) {
                alert("As senhas precisam ser iguais!");
                return false;
            }
            return true;
        }
    </script>
</body>
</html>